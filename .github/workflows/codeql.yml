# ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì´ ì›Œí¬í”Œë¡œìš° íŒŒì¼ì„ ë³€ê²½í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. 
# ë‹¨ìˆœíˆ ì €ì¥ì†Œì— ì»¤ë°‹í•˜ë©´ ë©ë‹ˆë‹¤.
#
# ë¶„ì„í•  ì–¸ì–´ ì§‘í•©ì„ ì¬ì •ì˜í•˜ê±°ë‚˜,
# ì‚¬ìš©ì ì§€ì • ì¿¼ë¦¬ ë˜ëŠ” ë¹Œë“œ ë¡œì§ì„ ì œê³µí•˜ê¸° ìœ„í•´ ì´ íŒŒì¼ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
#
# ******** ì°¸ê³  ********
# ì €ì¥ì†Œì˜ ì–¸ì–´ë¥¼ ê°ì§€í•˜ë ¤ê³  ì‹œë„í–ˆìŠµë‹ˆë‹¤. 
# ì•„ë˜ì— ì •ì˜ëœ `language` ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ í™•ì¸í•˜ì—¬ 
# ì˜¬ë°”ë¥¸ CodeQL ì§€ì› ì–¸ì–´ê°€ ì§€ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
#
name: "CodeQL Advanced"

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '25 18 * * 4'

jobs:
  analyze:
    name: Analyze (${{ matrix.language }})
    # Runner í¬ê¸°ëŠ” CodeQL ë¶„ì„ ì‹œê°„ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒ ë§í¬ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”:
    #   - https://gh.io/recommended-hardware-resources-for-running-codeql
    #   - https://gh.io/supported-runners-and-hardware-resources
    #   - https://gh.io/using-larger-runners (GitHub.com ì „ìš©)
    # ë” ë¹ ë¥¸ ë¶„ì„ ì‹œê°„ì„ ì›í•œë‹¤ë©´, ë” í° Runnerë‚˜ ë†’ì€ ì„±ëŠ¥ì˜ ë¨¸ì‹ ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•˜ì„¸ìš”.
    runs-on: ${{ (matrix.language == 'swift' && 'macos-latest') || 'ubuntu-latest' }}
    permissions:
      # required for all workflows (ëª¨ë“  ì›Œí¬í”Œë¡œìš°ì— í•„ìš”í•¨)
      security-events: write

      # required to fetch internal or private CodeQL packs (ë‚´ë¶€ ë˜ëŠ” ë¹„ê³µê°œ CodeQL íŒ©ì„ ê°€ì ¸ì˜¤ëŠ” ë° í•„ìš”í•¨)
      packages: read

      # only required for workflows in private repositories (ë¹„ê³µê°œ ì €ì¥ì†Œì˜ ì›Œí¬í”Œë¡œìš°ì—ë§Œ í•„ìš”í•¨)
      actions: read
      contents: read

    strategy:
      fail-fast: false
      matrix:
        include:
        - language: actions
          build-mode: none
        - language: java-kotlin
          build-mode: none # This mode only analyzes Java. Set this to 'autobuild' or 'manual' to analyze Kotlin too.
        - language: javascript-typescript
          build-mode: none
        # CodeQLì€ 'language' í‚¤ì›Œë“œì— ëŒ€í•´ ë‹¤ìŒ ê°’ì„ ì§€ì›í•©ë‹ˆë‹¤: 'actions', 'c-cpp', 'csharp', 'go', 'java-kotlin', 'javascript-typescript', 'python', 'ruby', 'rust', 'swift'
        # C, C++ ë˜ëŠ” ë‘˜ ë‹¤ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ë¶„ì„í•˜ë ¤ë©´ `c-cpp`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
        # Java, Kotlin ë˜ëŠ” ë‘˜ ë‹¤ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ë¶„ì„í•˜ë ¤ë©´ 'java-kotlin'ì„ ì‚¬ìš©í•˜ì„¸ìš”.
        # JavaScript, TypeScript ë˜ëŠ” ë‘˜ ë‹¤ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ë¶„ì„í•˜ë ¤ë©´ 'javascript-typescript'ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
        # ë¶„ì„í•  ì–¸ì–´ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ë¶„ì„ì„ ìœ„í•œ ë¹Œë“œ ëª¨ë“œë¥¼ ì‚¬ìš©ì ì§€ì •í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë” ì•Œì•„ë³´ë ¤ë©´,
        # https://docs.github.com/en/code-security/code-scanning/creating-an-advanced-setup-for-code-scanning/customizing-your-advanced-setup-for-code-scanning ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
        # ì»´íŒŒì¼ëœ ì–¸ì–´ë¥¼ ë¶„ì„í•˜ëŠ” ê²½ìš°, í•´ë‹¹ ì–¸ì–´ì˜ 'build-mode'ë¥¼ ìˆ˜ì •í•˜ì—¬ ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ ë°©ì‹ì„
        # ì‚¬ìš©ì ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ 
        # https://docs.github.com/en/code-security/code-scanning/creating-an-advanced-setup-for-code-scanning/codeql-code-scanning-for-compiled-languages ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    # `github/codeql-action/init` ì•¡ì…˜ì„ ì‹¤í–‰í•˜ê¸° ì „ì— í•„ìš”í•œ ì„¤ì • ë‹¨ê³„ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
    # ì—¬ê¸°ì—ëŠ” ì»´íŒŒì¼ëŸ¬ë‚˜ ëŸ°íƒ€ì„ ì„¤ì¹˜(`actions/setup-node` ë˜ëŠ” ê¸°íƒ€) ê°™ì€ ë‹¨ê³„ê°€ í¬í•¨ë©ë‹ˆë‹¤.
    # ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìˆ˜ë™ ë¹Œë“œì—ì„œë§Œ í•„ìš”í•©ë‹ˆë‹¤.
    # - name: Setup runtime (ì˜ˆì‹œ)
    #   uses: actions/setup-example@v1

    # ìŠ¤ìº”ì„ ìœ„í•´ CodeQL ë„êµ¬ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    - name: Initialize CodeQL
      uses: github/codeql-action/init@v3
      with:
        languages: ${{ matrix.language }}
        build-mode: ${{ matrix.build-mode }}
        # ì‚¬ìš©ì ì§€ì • ì¿¼ë¦¬ë¥¼ ì§€ì •í•˜ë ¤ë©´ ì—¬ê¸°ë‚˜ ì„¤ì • íŒŒì¼ì—ì„œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        # ê¸°ë³¸ì ìœ¼ë¡œ ì—¬ê¸° ë‚˜ì—´ëœ ì¿¼ë¦¬ëŠ” ì„¤ì • íŒŒì¼ì— ì§€ì •ëœ ì¿¼ë¦¬ë¥¼ ë®ì–´ì”ë‹ˆë‹¤.
        # ì´ ëª©ë¡ ì•ì— "+"ë¥¼ ë¶™ì´ë©´ ì—¬ê¸° ì¿¼ë¦¬ì™€ ì„¤ì • íŒŒì¼ ì¿¼ë¦¬ë¥¼ ëª¨ë‘ ì‚¬ìš©í•©ë‹ˆë‹¤.

        # CodeQL ì¿¼ë¦¬ íŒ©ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì„ ì°¸ì¡°í•˜ì„¸ìš”: https://docs.github.com/en/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/configuring-code-scanning#using-queries-in-ql-packs
        # queries: security-extended,security-and-quality

    # ë¶„ì„ ë‹¨ê³„ê°€ "ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ë¹Œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"ë¼ëŠ” ì˜¤ë¥˜ë¡œ ì‹¤íŒ¨í•˜ë©´,
    # ìœ„ì˜ ë§¤íŠ¸ë¦­ìŠ¤ì—ì„œ í•´ë‹¹ ì–¸ì–´ì˜ ë¹Œë“œ ëª¨ë“œë¥¼ "manual"ë¡œ ì„¤ì •í•˜ì„¸ìš”.
    # ê·¸ëŸ° ë‹¤ìŒ ì´ ë‹¨ê³„ì—ì„œ ì½”ë“œë¥¼ ì§ì ‘ ë¹Œë“œí•˜ë„ë¡ ìˆ˜ì •í•˜ì„¸ìš”.
    # â„¹ï¸ OS ì…¸ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•  ì»¤ë§¨ë“œë¼ì¸ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.
    # ğŸ“š ìì„¸í•œ ë‚´ìš©ì€ https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsrun ì„ ì°¸ê³ í•˜ì„¸ìš”.
    - if: matrix.build-mode == 'manual'
      shell: bash
      run: |
        echo 'If you are using a "manual" build mode for one or more of the' \
          'languages you are analyzing, replace this with the commands to build' \
          'your code, for example:'
        echo '  make bootstrap'
        echo '  make release'
        exit 1

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v3
      with:
        category: "/language:${{matrix.language}}"
